<div class="isapre-page">
  <header class="header-view">
    <div class="container-aligned">
      <h1>Planes Isapre</h1>
      <p>Compara planes con precios directos y <strong>sin costo adicional</strong></p>
    </div>
  </header>

  <section class="search-bar">
    <div class="search-grid container-aligned">

      <div class="box-input">
        <label>Regi√≥n</label>
        <select [(ngModel)]="filtros.region">
          <option value="" disabled selected>Selecciona</option>
          <option value="RM">Metropolitana</option>
        </select>
      </div>

      <div class="box-input">
        <label class="label-info">
            Renta imponible bruta
          <span class="info-icon">
            i
            <span class="tooltip">
              Puedes seleccionar el m√≠nimo o m√°ximo del valor prima dispuesto a pagar.
              Buscaremos productos cuyo valor final se encuentre en este rango.
            </span>
          </span>
        </label>
        <input type="number" [(ngModel)]="filtros.ingreso" placeholder="$ 0">
      </div>

      <div class="box-input">
        <label>Edad</label>
        <input type="number" [(ngModel)]="filtros.edad">
      </div>

      <div class="box-input">
        <label>sistema de salud actual</label>
          <input type="text">
      </div>

      <div class="box-input group-modal">
        <label>Asegurados</label>
        <button class="trigger" (click)="toggleModal()">
          {{ (cargas.length > 0 || tieneConyuge) ? 'Modificar asegurados' : 'Agregar asegurados' }}
        </button>

        <div class="popover-modal" *ngIf="mostrarModal">
          <div class="popover-head">
            <span>Agregar asegurados</span>
            <button (click)="mostrarModal = false">√ó</button>
          </div>

          <div class="popover-row">
            <label>Pareja/C√≥nyuge</label>
            <div class="toggle-switch">
              <input type="checkbox" id="conyuge" [(ngModel)]="tieneConyuge">
              <label for="conyuge" class="slider"></label>
            </div>
          </div>

          <div class="conyuge-details" *ngIf="tieneConyuge">
            <div class="conyuge-row-inline">
              <div class="sex-pick-full">
                <label>sistema de salud actual</label>
                <div class="radio-options">
                  <label>
                    <input type="text" [name]="'s-conyuge'">
                  </label>
                </div>
              </div>
              <div class="age-pick-full">
                <label>Edad*</label>
                <input type="number" [(ngModel)]="conyuge.edad" placeholder="27">
              </div>
            </div>

            <div class="input-full-width">
              <label>Renta imponible mensual / bruta</label>
              <input type="text" [(ngModel)]="conyuge.ingreso" placeholder="$ 0">
            </div>
          </div>

          <div class="popover-row">
            <label>Cargas</label>
            <div class="stepper">
              <button (click)="decrementarCargas()">‚àí</button>
              <span>{{ cargas.length }}</span>
              <button (click)="incrementarCargas()">+</button>
            </div>
          </div>

          <div class="cargas-dynamic-list" *ngIf="cargas.length > 0">
            <div class="carga-card-item" *ngFor="let c of cargas; let i = index">
              <p>Carga {{ i + 1 }}</p>

              <div class="carga-row-inline">
                <div class="age-pick-full">
                  <label>Edad</label>
                  <input type="number" [(ngModel)]="c.edad">
                </div>
              </div>
            </div>
          </div>

          <button class="btn-main-action" (click)="buscarPlanes()">Agregar y calcular precios</button>
        </div>
      </div>

      <button class="btn-search" (click)="buscarPlanes()">Calcular precios</button>
    </div>
  </section>

  <section class="results-bar">
    <div class="container-aligned results-grid">
      <div class="results-count">
        <h2>{{ resultados.length }} Resultados</h2>
      </div>

      <div class="rating-toggle">
        <label>
          <input type="checkbox">
          <span class="puntaje-badge">‚úÖ ¬øQu√© es el Puntaje?</span>
        </label>
      </div>

      <div class="sort-select">
        <label>Ordenar por:</label>
        <select [(ngModel)]="ordenarPor">
          <option value="price">Mayor Puntaje</option>
          <option value="rating">Precio Menor a Mayor</option>
          <option value="coverage">Precio Mayor a Menor</option>
        </select>
      </div>

      <div class="currency-select">
        <label>Moneda:</label>
        <select>
          <option value="clp">Pesos</option>
          <option value="uf">UF</option>
        </select>
      </div>

      <div class="view-mode-toggle">
        <button [class.active]="vista === 'list'" (click)="cambiarVista('list')">
          <span>&#9776;</span>
        </button>
        <button [class.active]="vista === 'grid'" (click)="cambiarVista('grid')">
          <span>&#9638;</span>
        </button>
      </div>
    </div>
  </section>
</div>

<div class="container results-layout">
  <aside class="sidebar">

    <!-- FILTRO: PRECIO -->
    <div class="filter-card">

      <div class="filter-header">
        <h4>
          Precio
          <span class="info-icon">i</span>
        </h4>
      </div>

      <div class="filter-body">

        <div class="price-values">
          <span class="price-min">$50.687</span>
          <span class="price-max">$271.030</span>
        </div>

        <div class="price-slider">
          <input type="range">
          <input type="range">
        </div>

      </div>
    </div>


    <!-- FILTRO: CL√çNICAS Y HOSPITALES -->
    <div class="filter-card">

      <div class="filter-header">
        <h4>
          Cl√≠nicas y Hospitales
          <span class="info-icon">i</span>
        </h4>
      </div>

      <div class="filter-body">

        <div class="clinic-search" (clickOutside)="mostrarDropdownClinicas = false">
          <input type="text" placeholder="Cl√≠nica..." (focus)="mostrarDropdownClinicas = true">

          <div class="clinic-dropdown" *ngIf="mostrarDropdownClinicas">
            <div class="clinic-item" (click)="seleccionarClinica('Arauco Salud')">Arauco Salud</div>
            <div class="clinic-item" (click)="seleccionarClinica('Bionet')">Bionet</div>
            <div class="clinic-item" (click)="seleccionarClinica('Centro Cl√≠nico el Portal')">Centro Cl√≠nico el Portal</div>
            <div class="clinic-item">Centro del C√°ncer UC CHRISTUS</div>
          </div>
        </div>


        <div class="clinic-options">

          <label class="clinic-option">
            <input type="checkbox" checked>
            <span class="option-text">Libre elecci√≥n</span>
            <span class="option-count">98</span>
          </label>

          <label class="clinic-option">
            <input type="checkbox" checked>
            <span class="option-text">Preferentes</span>
            <span class="option-count">1350</span>
          </label>

          <label class="clinic-option">
            <input type="checkbox" checked>
            <span class="option-text">Cerrados</span>
            <span class="option-count">55</span>
          </label>

        </div>

      </div>
    </div>




  </aside>


  <main class="results" id="cards-start">

    <!-- CARDS -->
    <div class="card" *ngFor="let plan of resultadosPaginados">
      <div class="card-left">
        <span class="tag">Preferente</span>

        <div class="company">
          <img src="https://via.placeholder.com/40">
          <strong>{{ plan.isapre }}</strong>
        </div>

        <h5>{{ plan.nombrePlan }}</h5>

        <div class="features">
          <span>üè• Hospitalaria 90%</span>
          <span>üöë Urgencia 70%</span>
          <span>ü©∫ Ambulatoria 70%</span>
          <span>üìÑ Tope anual 7.000 UF</span>
        </div>
      </div>

      <div class="card-center">
        <label>
          <input type="checkbox"> Comparar
        </label>

        <div class="score" *ngIf="mostrarPuntaje">
          Puntaje
          <span class="score-value">7.8</span>
          <small>de 7.8</small>
        </div>
      </div>

      <div class="card-right">
        <span class="price-label">Desde</span>
        <span class="price">${{ plan.valor | number:'1.0-0' }}</span>
        <small>/mes</small>

        <button class="btn-solicitar" (click)="abrirSolicitud(plan)">
          Solicitar
        </button>

        <button class="btn-secondary" (click)="abrirDetalle(plan)">
          Ver detalle
        </button>
      </div>
    </div>

    
    <!-- PAGINACI√ìN -->
    <div class="pagination" *ngIf="totalPaginas > 1">

      <button (click)="paginaAnterior()" [disabled]="paginaActual === 1">
        ‚Äπ Anterior
      </button>

      <!-- P√°gina 1 -->
      <button
        *ngIf="mostrarPrimeraPagina"
        (click)="irAPagina(1)"
        [class.active]="paginaActual === 1">
        1
      </button>

      <!-- Dots inicial -->
      <span class="dots" *ngIf="mostrarDotsInicio">‚Ä¶</span>

      <!-- P√°ginas centrales -->
      <button
        *ngFor="let page of paginasVisibles"
        (click)="irAPagina(page)"
        [class.active]="paginaActual === page">
        {{ page }}
      </button>

      <!-- Dots final -->
      <span class="dots" *ngIf="mostrarDotsFinal">‚Ä¶</span>

      <!-- √öltima p√°gina -->
      <button
        *ngIf="mostrarUltimaPagina"
        (click)="irAPagina(totalPaginas)"
        [class.active]="paginaActual === totalPaginas">
        {{ totalPaginas }}
      </button>

      <button (click)="paginaSiguiente()" [disabled]="paginaActual === totalPaginas">
        Siguiente ‚Ä∫
      </button>

    </div>


  </main>
</div>

<app-modal-detalle
  [plan]="planSeleccionado"
  [isVisible]="mostrarDetalleModal"
  (close)="cerrarDetalle()"
  (solicitar)="desdeDetalleASolicitar()">
</app-modal-detalle>

<app-modal-solicitar
  [plan]="planSeleccionado"
  [isVisible]="mostrarSolicitarModal"
  (close)="cerrarSolicitar()"
  (submitForm)="procesarSolicitud($event)"
  (verDetallePlan)="abrirDetalleDesdeSolicitar()">
</app-modal-solicitar>
